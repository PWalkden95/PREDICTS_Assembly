---
title: "Hypervolume_analyses"
author: "Patrick Alexander Walkden"
date: "29/10/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Hypervolume Analyses

Following generating the species pool and performing randomisations it's time to look at how functional diversity is impacted across the land-use gradient and how the occupancy of trait space compares to that of a null commmunity. 


```{r load in packages and data}
rm(list = ls())

## loading in tidyverse and the functions I have created to analyise and visualise the differences between TPD hypervolumes
require(tidyverse)
source("Functions/TPD_3D_plots.R")

## load in all the data

 PREDICTS_tpds <- readRDS("Outputs/PREDICTS_sites_tpds.rds") # morphometric TPDs of observed sites
 
 PREDICTS_tpds_for <- readRDS("Outputs/PREDICTS_sites_for_tpds.rds") ## foragaing TPDs of observed sites
 
 PREDICTS_randomisations <- readRDS("Outputs/randomisations_TPD_morpho.rds") ## morphometric TPD of randomisised sites 
 
 PREDICTS <- readRDS("Outputs/refined_predicts.rds") %>%  ## PREDICTS data 
   dplyr::distinct(SSBS, Predominant_habitat, Use_intensity, Biome, UN_subregion, Realm) %>% ## pull out land_use type, Subregion, realm etc
   dplyr::mutate(Predominant_habitat = ifelse(grepl(Predominant_habitat, pattern = "secondary", ignore.case = TRUE), "Secondary vegetation",
                                              paste(Predominant_habitat))) %>% data.frame() ## merge all secondary sites together
 
 
 species_TPD <- readRDS("Outputs/species_tpds_morpho.rds") ## individual species TPDs 

```

# site distribution

First things first, lets see how the sites that have a TPD calculated for them are distributedacross land-uses and biogeographic realms.


```{r pressure, echo=FALSE}
 
## c

 TPD_LU <- data.frame(SSBS = names(PREDICTS_tpds)) %>% dplyr::left_join(PREDICTS) %>% dplyr::filter(Predominant_habitat != "Cannot decice",
                                                                                                    Use_intensity != "Cannot decide")

 table(TPD_LU$Predominant_habitat, TPD_LU$Realm)
```
Here we can see that there is quite an uneven spread of sites across the LU types and Realms so to check whether there are enough sites I am going to iteratively calculate functional diversity metrics for each LU-realm combination and if FD reaches an asymptote it will indicate that there are sufficent sites so that trait spaces can be compared.

```{r LU realm combos}

### pull land_uses

land_uses <- PREDICTS %>% dplyr::distinct(Predominant_habitat, .keep_all = FALSE) %>% dplyr::filter(Predominant_habitat != "Cannot decide") %>% 
   pull() %>% as.character()
```
